(()=>{var e={};e.id=4950,e.ids=[4950],e.modules={3295:e=>{"use strict";e.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},10846:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},11187:(e,r,t)=>{"use strict";t.r(r),t.d(r,{patchFetch:()=>x,routeModule:()=>l,serverHooks:()=>v,workAsyncStorage:()=>h,workUnitAsyncStorage:()=>f});var s={};t.r(s),t.d(s,{DELETE:()=>p,GET:()=>u,POST:()=>d});var a=t(96559),n=t(48088),i=t(37719),o=t(32190),c=t(11735);async function u(e){try{let[e,r,t]=await c.z.$transaction([c.z.user.findMany({orderBy:{name:"asc"},select:{id:!0,name:!0,username:!0,isActive:!0,vehiclekey:!0}}),c.z.vehicle.findMany(),c.z.vehicleKey.findMany({include:{user:{select:{id:!0,name:!0,username:!0,isActive:!0}},vehicle:!0},orderBy:{createdAt:"desc"}})]);return o.NextResponse.json({users:e,vehicles:r,vehicleKeys:t})}catch(e){return console.error("Error fetching data:",e),o.NextResponse.json({error:"Error fetching data"},{status:500})}}async function d(e){try{let{userId:r,vehicleId:t,parentId:s,id:a}=await e.json();if(!r||!t)return o.NextResponse.json({error:"Missing required fields"},{status:400});let n=await c.z.$transaction(async e=>{if(!await e.user.findUnique({where:{id:r}}))throw Error("User not found");if(!await e.vehicle.findUnique({where:{id:t}}))throw Error("Vehicle not found");return await e.vehicleKey.create({data:{userId:r,vehicleId:t,parentId:s,status:a?"CONFIRMED":"PENDING"},include:{user:!0,vehicle:!0}})});return o.NextResponse.json(n)}catch(e){return console.error("Error creating transfer:",e),o.NextResponse.json({error:"Error creating transfer"},{status:500})}}async function p(e,{params:r}){try{let e=(await r).id,t=await c.z.vehicleKey.delete({where:{id:e,status:"PENDING"}});if(!t)throw Error("Transfer\xeancia pendente n\xe3o encontrada!");return o.NextResponse.json(t,{status:201})}catch(e){return console.error("Erro, rejeitando a transfer\xeancia:",e),o.NextResponse.json({error:"Erro, rejeitando a transfer\xeancia"},{status:500})}}let l=new a.AppRouteRouteModule({definition:{kind:n.RouteKind.APP_ROUTE,page:"/api/v2/dashboard/keys/route",pathname:"/api/v2/dashboard/keys",filename:"route",bundlePath:"app/api/v2/dashboard/keys/route"},resolvedPagePath:"C:\\Users\\carlos.dias\\Documents\\repositorio\\checklist_mui\\src\\app\\api\\v2\\dashboard\\keys\\route.ts",nextConfigOutput:"",userland:s}),{workAsyncStorage:h,workUnitAsyncStorage:f,serverHooks:v}=l;function x(){return(0,i.patchFetch)({workAsyncStorage:h,workUnitAsyncStorage:f})}},11735:(e,r,t)=>{"use strict";t.d(r,{A:()=>n,z:()=>a});var s=t(96330);let a=global.prisma||new s.PrismaClient,n=a},29294:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},44870:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},63033:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},78335:()=>{},96330:e=>{"use strict";e.exports=require("@prisma/client")},96487:()=>{},96559:(e,r,t)=>{"use strict";e.exports=t(44870)}};var r=require("../../../../../webpack-runtime.js");r.C(e);var t=e=>r(r.s=e),s=r.X(0,[80],()=>t(11187));module.exports=s})();